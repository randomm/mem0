---
title: Matryoshka Embeddings
description: Using Matryoshka Representation Learning for embedding truncation with pgvector.
---

# Matryoshka Embeddings with pgvector

Mem0 supports [Matryoshka Representation Learning (MRL)](https://arxiv.org/abs/2209.01975) for embedding models like Jina Embeddings v3 that implement this capability. This allows you to truncate embedding dimensions to save space and improve performance while maintaining good accuracy, specifically when using the `pgvector` vector store provider.

## Configuration

To use matryoshka embedding truncation with pgvector, set the `matryoshka_dims` parameter in your `vector_store` configuration. You must also provide the original `embedding_model_dims`.

```python
config = {
    "embedder": {
        "provider": "huggingface",
        "config": {
            "model": "jinaai/jina-embeddings-v3",
            # Ensure the embedder knows the *original* full dimension
            "embedding_dims": 1024  
        }
    },
    "vector_store": {
        "provider": "pgvector",
        "config": {
            "user": "postgres_user",
            "password": "password",
            "host": "localhost",
            "port": "5432",
            "dbname": "mem0_db",
            "collection_name": "jina_matryoshka_docs",
            "embedding_model_dims": 1024,  # Original (full) dimension of the model
            "matryoshka_dims": 512         # Target dimension for truncation
            # Other pgvector options like hnsw can be added here
        }
    }
}
```

When `matryoshka_dims` is set:

1.  **Table Creation**: The `vector` column in the PostgreSQL table will be created with the `matryoshka_dims` dimension (e.g., `VECTOR(512)`).
2.  **Insertion**: Embeddings generated by the embedder (at full dimension) will be automatically truncated to `matryoshka_dims` before being stored in the database.
3.  **Search**: Query vectors will also be truncated to `matryoshka_dims` before performing the similarity search against the stored truncated vectors.

## Performance Considerations

Truncating embeddings can offer significant benefits:

*   **Reduced Storage**: Storing smaller vectors requires less disk space.
*   **Faster Queries**: Searching over lower-dimensional vectors is generally faster.
*   **Lower Memory Usage**: Indexing smaller vectors consumes less RAM.

For Jina Embeddings v3, here are potential truncation levels and their typical performance trade-offs (relative to the full 1024 dimension):

*   **1024 → 512**: Minimal performance loss (~1-2%)
*   **1024 → 256**: Slight performance loss (~2-5%)
*   **1024 → 128**: Moderate performance loss (~5-10%)
*   **1024 → 64**: More noticeable performance loss (>10%)

Choose the dimension that best balances your needs for performance, storage, and accuracy.

## Important Notes

*   **Supported Models**: Matryoshka truncation only works effectively with models specifically trained for it (like Jina v3).
*   **Trained Granularities**: For best results, truncate to dimensions the model was trained on (e.g., Jina v3 supports 128, 256, 512, 1024).
*   **Incompatible with Quantization**: Matryoshka truncation (`matryoshka_dims`) cannot be used simultaneously with binary quantization (`quantization` config). If both are specified, binary quantization will take precedence, and the `matryoshka_dims` setting will be ignored.
*   **Provider Specific**: This feature is currently implemented specifically for the `pgvector` provider in Mem0. 